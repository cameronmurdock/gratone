import React, { useState, useEffect } from 'react';
import { Menu, Search, Sun, Moon, ChevronRight, ChevronDown } from 'lucide-react';
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';
import { Card, CardContent } from '@/components/ui/card';

const Documentation = () => {
  const [isSidebarOpen, setIsSidebarOpen] = useState(window.innerWidth > 768);
  const [isDarkMode, setIsDarkMode] = useState(
    localStorage.getItem('theme') === 'dark'
  );
  const [searchTerm, setSearchTerm] = useState('');
  const [activeGroup, setActiveGroup] = useState('getting-started');
  const [activePage, setActivePage] = useState('introduction');

  // Document sections with nested content
  const sections = {
    'getting-started': {
      title: 'Getting Started',
      pages: {
        'introduction': {
          title: 'Introduction',
          content: 'Welcome to our documentation. This guide will help you get started with our platform.'
        },
        'quick-start': {
          title: 'Quick Start',
          content: 'Follow these steps to quickly get up and running with our platform.'
        },
        'installation': {
          title: 'Installation',
          content: 'Detailed installation instructions for different environments.'
        }
      }
    },
    'core-concepts': {
      title: 'Core Concepts',
      pages: {
        'architecture': {
          title: 'Architecture',
          content: 'Understanding the core architecture of our platform.'
        },
        'configuration': {
          title: 'Configuration',
          content: 'Learn how to configure the platform for your needs.'
        },
        'plugins': {
          title: 'Plugins',
          content: 'Extend functionality using our plugin system.'
        }
      }
    },
    'advanced': {
      title: 'Advanced',
      pages: {
        'custom-themes': {
          title: 'Custom Themes',
          content: 'Create and customize themes for your documentation.'
        },
        'api-reference': {
          title: 'API Reference',
          content: 'Complete API documentation and examples.'
        },
        'migration': {
          title: 'Migration Guide',
          content: 'Guide for migrating between versions.'
        }
      }
    }
  };

  // Update theme
  useEffect(() => {
    document.documentElement.setAttribute(
      'data-theme',
      isDarkMode ? 'dark' : 'light'
    );
    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
  }, [isDarkMode]);

  // Handle window resize
  useEffect(() => {
    const handleResize = () => {
      if (window.innerWidth > 768) {
        setIsSidebarOpen(true);
      }
    };
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // Filter pages based on search term
  const filterContent = (pages) => {
    if (!searchTerm) return pages;
    return Object.entries(pages).reduce((filtered, [key, page]) => {
      if (
        page.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
        page.content.toLowerCase().includes(searchTerm.toLowerCase())
      ) {
        filtered[key] = page;
      }
      return filtered;
    }, {});
  };

  return (
    <div className="min-h-screen bg-background">
      {/* Header */}
      <header className="fixed top-0 left-0 right-0 h-16 border-b bg-background z-50">
        <div className="h-full px-6 flex items-center gap-4">
          <button
            onClick={() => setIsSidebarOpen(!isSidebarOpen)}
            className="p-2 hover:bg-accent rounded-md"
          >
            <Menu className="h-5 w-5" />
          </button>
          
          <a href="#" className="text-xl font-semibold">
            Documentation
          </a>
          
          <div className="relative flex-1 max-w-xl">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <input
              type="text"
              placeholder="Search documentation..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 bg-muted rounded-md text-sm"
            />
          </div>
          
          <button
            onClick={() => setIsDarkMode(!isDarkMode)}
            className="p-2 hover:bg-accent rounded-md"
          >
            {isDarkMode ? <Sun className="h-5 w-5" /> : <Moon className="h-5 w-5" />}
          </button>
        </div>
      </header>

      {/* Sidebar */}
      <aside
        className={`fixed top-16 bottom-0 w-64 border-r bg-muted/50 transition-transform duration-300 ${
          isSidebarOpen ? 'translate-x-0' : '-translate-x-full'
        } md:translate-x-0`}
      >
        <div className="h-full overflow-y-auto">
          {Object.entries(sections).map(([groupId, group]) => (
            <div key={groupId} className="py-2">
              <button
                onClick={() => setActiveGroup(groupId)}
                className="w-full px-4 py-2 flex items-center justify-between hover:bg-accent"
              >
                <span className="font-semibold">{group.title}</span>
                {activeGroup === groupId ? (
                  <ChevronDown className="h-4 w-4" />
                ) : (
                  <ChevronRight className="h-4 w-4" />
                )}
              </button>
              
              {activeGroup === groupId && (
                <div className="mt-1">
                  {Object.entries(filterContent(group.pages)).map(([pageId, page]) => (
                    <button
                      key={pageId}
                      onClick={() => {
                        setActivePage(pageId);
                        if (window.innerWidth <= 768) {
                          setIsSidebarOpen(false);
                        }
                      }}
                      className={`w-full px-6 py-2 text-left hover:bg-accent text-sm ${
                        activePage === pageId ? 'bg-accent font-medium' : ''
                      }`}
                    >
                      {page.title}
                    </button>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      </aside>

      {/* Main Content */}
      <main
        className={`transition-all duration-300 ${
          isSidebarOpen ? 'md:pl-64' : ''
        }`}
      >
        <div className="max-w-4xl mx-auto p-8 pt-24">
          <Card>
            <CardContent className="p-6">
              <h1 className="text-3xl font-bold mb-6">
                {sections[activeGroup]?.pages[activePage]?.title}
              </h1>
              <div className="prose max-w-none">
                {sections[activeGroup]?.pages[activePage]?.content}
              </div>
            </CardContent>
          </Card>
        </div>
      </main>
    </div>
  );
};

export default Documentation;
